package com.example.An_Yang.controller;

import com.example.An_Yang.domain.ChatHistory;
import com.example.An_Yang.service.ChatHistoryService;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.RestController;
import java.time.LocalDateTime;
import java.util.List;

@RestController
@RequestMapping("/api/history")
public class ChatHistoryController {

	private final ChatHistoryService chatHistoryService;

	public ChatHistoryController(ChatHistoryService chatHistoryService) {
		this.chatHistoryService = chatHistoryService;
	}

	@GetMapping("/recent")
	public List<ChatHistory> getRecentChats(@RequestParam(defaultValue = "10") int limit) {
		return chatHistoryService.getRecentChats(limit);
	}

	@GetMapping("/period")
	public List<ChatHistory> getChatsByPeriod(@RequestParam String start, @RequestParam String end) {
		return chatHistoryService.getChatsByPeriod(LocalDateTime.parse(start), LocalDateTime.parse(end));
	}

	@GetMapping("/question")
	public List<ChatHistory> getChatsByQuestionKeyword(@RequestParam String keyword) {
		return chatHistoryService.getChatsByQuestionKeyword(keyword);
	}

	@GetMapping("/answer")
	public List<ChatHistory> getChatsByAnswerKeyword(@RequestParam String keyword) {
		return chatHistoryService.getChatsByAnswerKeyword(keyword);
	}

	@GetMapping("/latest")
	public List<ChatHistory> getLatestChatsByKeyword(@RequestParam String keyword,
	                                                 @RequestParam(defaultValue = "5") int limit) {
		return chatHistoryService.getLatestChatsByKeyword(keyword, limit);
	}
}

